# Лабораторная работа №2

## "CI/CD для Docker приложения"
### Описание
Это вторая лабораторная работа по настройке CI/CD пайплайна для автоматической сборки, публикации и деплоя Docker образа из первой лабораторной работы.

### Цель работы
Научиться настраивать автоматизированные пайплайны для сборки Docker образов, их публикации в registry и автоматического деплоя при изменении кода.

### Правила по оформлению
Правила по оформлению отчета по лабораторной работе вы можете изучить по [ссылке](../reportdesign.md)

### Ход работы

#### Обычная лабораторная работа

**Настройка CI/CD пайплайна с GitHub Actions:**

1. **Подготовка проекта:**
      - Скопировать файлы из первой лабораторной (app.py, requirements.txt, Dockerfile) в новый репозиторий
      - Создать аккаунт на Docker Hub (если нет)
      - Создать новый репозиторий на Docker Hub для вашего образа

2. **Настройка GitHub Actions:**
      - Создать папку `.github/workflows/` в корне проекта
      - Создать файл `docker-build.yml` с пайплайном, который должен:
        - Запускаться при пуше в main ветку
        - Использовать Ubuntu как runner
        - Выполнять checkout кода
        - Настраивать Docker Buildx
        - Логиниться в Docker Hub используя секреты
        - Собирать и пушить образ с тегом `username/my-flask-app:latest`
        - Добавлять шаг деплоя (можно просто echo сообщение)

3. **Настройка секретов:**
      - В настройках GitHub репозитория добавить секреты:
        - `DOCKER_USERNAME` - ваш логин на Docker Hub
        - `DOCKER_PASSWORD` - ваш пароль или токен доступа Docker Hub

4. **Тестирование пайплайна:**
      - Сделать коммит и пуш в main ветку
      - Проверить выполнение пайплайна в разделе Actions
      - Убедиться, что образ появился в Docker Hub
      - Проверить логи выполнения каждого шага

#### Лабораторная работа со звездочкой

**Настройка деплоя для разных веток:**

1. **Создание ветки для разработки:**
      - Создать ветку `develop` для разработки
      - Настроить пайплайн так, чтобы он запускался для обеих веток (main и develop)

2. **Условный деплой:**
      - Для ветки `main` (продакшн): echo "Deploying to production server..."
      - Для ветки `develop` (разработка): echo "Deploying to development server..."
      - Использовать условия в GitHub Actions для разного поведения

3. **Тестирование:**
      - Сделать коммит в ветку `develop` и проверить сообщение
      - Сделать коммит в ветку `main` и проверить сообщение
      - Убедиться, что деплой работает по-разному для разных веток

**Результат:** Вы должны уметь настраивать условный деплой в зависимости от ветки.

### Результаты лабораторной работы
В результате данной работы у вас должно быть:

- Настроенный CI/CD пайплайн с GitHub Actions
- Автоматическая сборка и публикация Docker образа в Docker Hub
- Настроенные секреты для безопасной работы с registry
- (Для работы со звездочкой) Продвинутый пайплайн с тестированием и версионированием
- Отчет по лабораторной работе с описанием настроенного пайплайна

### Полезные ссылки

- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Docker Hub](https://hub.docker.com/)
- [Docker Buildx](https://docs.docker.com/buildx/)
- [GitHub Actions for Docker](https://github.com/docker/build-push-action)
- [Docker Hub Authentication](https://docs.docker.com/docker-hub/access-tokens/)
